# Multi-container deployment with Docker Compose

serversGuru:
  apiKey: '${SERVERSGURU_API_KEY}'

vps:
  type: 'NL1-4' # 4 vCPUs, 8GB RAM for multi-container setup
  osImage: 'ubuntu-22.04'
  billingCycle: 1
  hostname: 'multi-container-app'

ssh:
  port: 22
  username: root
  connectionTimeout: 30000
  commandTimeout: 600000 # Longer timeout for multi-container setup

app:
  name: 'myapp'
  dockerImage: 'ghcr.io/your-username/myapp:latest'
  registryAuth:
    username: '${DOCKER_REGISTRY_USERNAME}'
    password: '${DOCKER_REGISTRY_PASSWORD}'
    registry: ghcr.io
  port: 3000
  healthEndpoint: '/health'
  envVars:
    NODE_ENV: 'production'
    DATABASE_URL: 'postgresql://app:${DATABASE_PASSWORD}@db:5432/app'
    REDIS_URL: 'redis://redis:6379'

  # Docker Compose configuration for additional services
  dockerCompose:
    version: '3.8'
    services:
      redis:
        image: 'redis:7-alpine'
        restart: unless-stopped
        volumes:
          - 'redis_data:/data'
        healthcheck:
          test: ['CMD', 'redis-cli', 'ping']
          interval: 10s
          timeout: 5s
          retries: 3

      db:
        image: 'postgres:15-alpine'
        restart: unless-stopped
        environment:
          POSTGRES_USER: 'app'
          POSTGRES_PASSWORD: '${DATABASE_PASSWORD}'
          POSTGRES_DB: 'app'
        volumes:
          - 'postgres_data:/var/lib/postgresql/data'
        healthcheck:
          test: ['CMD-SHELL', 'pg_isready -U app']
          interval: 10s
          timeout: 5s
          retries: 5

    volumes:
      redis_data:
      postgres_data:

domain:
  name: 'app.example.com'
  email: 'admin@example.com'

options:
  createSnapshot: true
  healthCheckRetries: 20 # More retries for multi-container startup
  healthCheckInterval: 5000
  provisioningTimeout: 600000
  setupTimeout: 1200000 # 20 minutes for larger setup
